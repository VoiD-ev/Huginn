generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRESQL_URL")
}

model User {
  id                   BigInt         @id
  username             String         @unique
  displayName          String
  email                String         @unique
  avatar               String
  password             String
  flags                Int            @db.SmallInt
  system               Boolean        @default(false)
  includedChannels     Channel[]      @relation("channel_users")
  ownedChannels        Channel[]      @relation("channel_owner")
  messages             Message[]
  mentionedMessages    Message[]      @relation("message_mentions")
  relationships        Relationship[] @relation("relation_owner")
  relatedRelationships Relationship[] @relation("relation_user")
}

model Channel {
  id            BigInt    @id
  icon          String?
  lastMessageId String?
  name          String?
  owner         User?     @relation("channel_owner", fields: [ownerId], references: [id])
  ownerId       BigInt?
  recipients    User[]    @relation("channel_users")
  messages      Message[]
  type          Int
}

model Message {
  id          BigInt    @id
  author      User      @relation(fields: [authorId], references: [id])
  authorId    BigInt
  channel     Channel   @relation(fields: [channelId], references: [id])
  channelId   BigInt
  content     String
  createdAt   DateTime
  editedAt    DateTime?
  mentions    User[]    @relation("message_mentions")
  attachments String[]
  reactions   String[]
  pinned      Boolean
  type        Int
  flags       Int?      @db.SmallInt
}

// model ChannelsOnUsers {
//   user      User    @relation(fields: [userId], references: [id])
//   userId    BigInt
//   channel   Channel @relation(fields: [channelId], references: [id])
//   channelId BigInt

//   @@id([userId, channelId])
// }

// model UserMentionsOnMessages {
//   user      User    @relation(fields: [userId], references: [id])
//   userId    BigInt
//   message   Message @relation(fields: [messageId], references: [id])
//   messageId BigInt

//   @@id([userId, messageId])
// }

model Relationship {
  id       BigInt    @id
  type     Int       @db.SmallInt
  nickname String
  since    DateTime?
  owner    User      @relation("relation_owner", fields: [ownerId], references: [id])
  ownerId  BigInt
  user     User      @relation("relation_user", fields: [userId], references: [id])
  userId   BigInt
}
